<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>اختبار اللغة الإنجليزية - الصف الثاني الإعدادي</title>
    <link rel="stylesheet" href="../../css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* أنماط عامة */
        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        
        /* الحاوية الرئيسية */
        .exam-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
        }
        
        /* رأس الامتحان */
        .exam-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #007bff;
        }
        
        .exam-header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        /* إحصائيات الأسئلة */
        .stats {
            background: #e9f5ff;
            padding: 10px 15px;
            border-radius: 5px;
            margin: 15px 0;
            font-weight: bold;
            text-align: center;
            border-right: 4px solid #007bff;
        }
        
        /* الأسئلة */
        .question {
            margin-bottom: 25px;
            padding: 20px;
            border: 1px solid #eee;
            border-radius: 8px;
            background-color: #fafafa;
            transition: all 0.3s ease;
        }
        
        .question:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .question h3 {
            color: #007bff;
            margin-top: 0;
            padding-bottom: 10px;
            border-bottom: 1px dashed #ddd;
        }
        
        /* النصوص والقصائد */
        .passage, .poem {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            line-height: 1.8;
            font-style: italic;
            border-right: 4px solid #6c757d;
        }
        
        .poem {
            text-align: center;
            font-weight: bold;
            background: #fff9e6;
            border-right-color: #ffc107;
        }
        
        /* خيارات الأسئلة */
        .options {
            margin: 20px 0;
        }
        
        .option {
            margin-bottom: 10px;
            padding: 12px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid #e0e0e0;
            background: white;
        }
        
        .option:hover {
            background-color: #e9f5ff;
            transform: translateX(-5px);
        }
        
        .option.selected {
            background-color: #d4edff;
            border-left: 4px solid #007bff;
        }
        
        .option.correct {
            background-color: #d4edda;
            border-left: 4px solid #28a745;
        }
        
        .option.incorrect {
            background-color: #f8d7da;
            border-left: 4px solid #dc3545;
        }
        
        /* شرح الإجابة */
        .explanation {
            display: none;
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
            border-right: 3px solid #6c757d;
        }
        
        /* حقول الإدخال */
        .fill-in-blank input {
            width: 100%;
            padding: 12px;
            margin: 15px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
            transition: border 0.3s;
        }
        
        .fill-in-blank input:focus {
            border-color: #007bff;
            outline: none;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
        }
        
        /* التنقل بين الأسئلة */
        .navigation {
            display: flex;
            justify-content: space-between;
            margin: 30px 0;
        }
        
        /* الأزرار */
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 16px;
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .btn-primary {
            background-color: #007bff;
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            background-color: #0069d9;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover:not(:disabled) {
            background-color: #5a6268;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background-color: #28a745;
            color: white;
        }
        
        .btn-success:hover:not(:disabled) {
            background-color: #218838;
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background-color: #dc3545;
            color: white;
        }
        
        .btn-danger:hover:not(:disabled) {
            background-color: #c82333;
            transform: translateY(-2px);
        }
        
        .btn-warning {
            background-color: #ffc107;
            color: #212529;
        }
        
        .btn-warning:hover:not(:disabled) {
            background-color: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-info {
            background-color: #17a2b8;
            color: white;
        }
        
        .btn-info:hover:not(:disabled) {
            background-color: #138496;
            transform: translateY(-2px);
        }
        
        /* النتائج */
        .results-container {
            display: none;
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .score {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            margin: 20px 0;
            color: #007bff;
        }
        
        .feedback {
            text-align: center;
            font-size: 18px;
            margin: 15px 0;
            color: #28a745;
            font-weight: bold;
        }
        
        .result-item {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 8px;
            background-color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .recommendations {
            background-color: #fff3cd;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid #ffeaa7;
        }
        
        .correct-answer {
            color: #28a745;
            font-weight: bold;
        }
        
        /* عناصر التحكم */
        .controls {
            margin-top: 30px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        /* التكيف مع الشاشات الصغيرة */
        @media (max-width: 768px) {
            .exam-container {
                padding: 15px;
            }
            
            .navigation {
                flex-direction: column;
                gap: 10px;
            }
            
            .btn {
                width: 100%;
                margin-bottom: 5px;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .question {
                padding: 15px;
            }
            
            .passage, .poem {
                padding: 15px;
            }
        }
    </style></head>
<body>
    <div class="exam-container">
        <div class="exam-header">
            <h1 id="exam-title">اختبار اللغة الإنجليزية - الصف الثاني الإعدادي (Unit 4) - الترم الأول</h1>
        </div>
        
        <div class="stats">السؤال <span id="current-question">1</span> من <span id="total-questions">29</span></div>
        
        <div id="questions-container"></div>
        
        <div class="navigation">
            <button id="prev-btn" class="btn btn-secondary" disabled>السابق</button>
            <button id="next-btn" class="btn btn-primary">التالي</button>
        </div>
        
        <div class="controls">
            <button id="restart-btn" class="btn btn-warning">إعادة البدء</button>
            <button id="print-btn" class="btn btn-info">طباعة النتائج</button>
            <button id="share-btn" class="btn btn-success">مشاركة النتائج</button>
            <button id="back-btn" class="btn btn-danger">العودة للامتحانات</button>
        </div>
        
        <div class="results-container" id="results-container">
            <h2>النتيجة</h2>
            <div id="score"></div>
            <div id="detailed-results"></div>
        </div>
    </div>

    <audio id="correctSound" src="../../../assets/audio/correct.mp3" preload="auto"></audio>
    <audio id="incorrectSound" src="../../../assets/audio/incorrect.mp3" preload="auto"></audio>


   <script>
    // أصوات
    const correctSound = document.getElementById('correctSound');
    const incorrectSound = document.getElementById('incorrectSound');

    // معرف الامتحان
    const examId = "arabic-grade1-term1";

    // بيانات الأسئلة (كما أرسلتها)
    const examData = {
        title: "اختبار اللغة الإنجليزية - الصف الثاني الإعدادي (Unit 4) - الترم الأول",
        questions: [
           {
        "id": 1,
        "type": "multiple-choice",
        "text": "Who first played this game?",
        "options": [
            { "id": 1, "text": "the Romans", "correct": false },
            { "id": 2, "text": "the English", "correct": false },
            { "id": 3, "text": "the Indians", "correct": false },
            { "id": 4, "text": "the ancient Egyptians", "correct": true }
        ],
        "explanation": "يُعتقد أن ألعاب الطاولة (مثل الشطرنج أو لعبة 'سنتر') نشأت في مصر القديمة."
    },
    {
        "id": 2,
        "type": "multiple-choice",
        "text": "How old is this game?",
        "options": [
            { "id": 1, "text": "350", "correct": false },
            { "id": 2, "text": "3500", "correct": true },
            { "id": 3, "text": "3050", "correct": false },
            { "id": 4, "text": "3005", "correct": false }
        ],
        "explanation": "بعض الألعاب القديمة مثل 'سنتر' يعود عمرها إلى أكثر من 3500 سنة."
    },
    {
        "id": 3,
        "type": "multiple-choice",
        "text": "How many squares does this game have?",
        "options": [
            { "id": 1, "text": "13", "correct": false },
            { "id": 2, "text": "31", "correct": false },
            { "id": 3, "text": "30", "correct": true },
            { "id": 4, "text": "300", "correct": false }
        ],
        "explanation": "لعبة 'سنتر' (Senet) تُلعب على لوح به 30 مربعًا."
    },
    {
        "id": 4,
        "type": "multiple-choice",
        "text": "A: What did people who didn't have these boxes do?\nB: They drew squares on the ___",
        "options": [
            { "id": 1, "text": "wall", "correct": false },
            { "id": 2, "text": "hill", "correct": false },
            { "id": 3, "text": "roof", "correct": false },
            { "id": 4, "text": "floor", "correct": true }
        ],
        "explanation": "في الماضي، كان الناس يرسمون الألعاب على الأرض أو الأرضية."
    },
    {
        "id": 5,
        "type": "fill-in-blank",
        "text": "Fady: Do you think this plan for the new hotel is a good idea, Baher?\nBaher: (1)....",
        "correctAnswer": "I don't think so",
        "explanation": "رأي معارض"
    },
    {
        "id": 6,
        "type": "fill-in-blank",
        "text": "Fady: Why?\nBaher: (2)....",
        "correctAnswer": "If only it had jobs for people in the city",
        "explanation": "تمني بوجود فرصة عمل"
    },
    {
        "id": 7,
        "type": "fill-in-blank",
        "text": "Fady: Because more tourists in the area can help the local people.\nBaher: (3)....",
        "correctAnswer": "But what about the environment?",
        "explanation": "سؤال انتقادي حول البيئة"
    },
    {
        "id": 8,
        "type": "fill-in-blank",
        "text": "Fady: Taking water from the lake will damage the environment. It's important to protect the environment.\nBaher: (4)....",
        "correctAnswer": "You're right. Maybe we need a better plan",
        "explanation": "اقتناع بوجهة نظر الصديق"
    },
    {
        "id": 9,
        "type": "passage",
        "content": "One of the hobbies that people like is to collect things such as stamps, books, old coins and ancient pictures. But the strangest collection I have ever seen belongs to a man who owns four hundred clocks. There are clocks in every room of his house. The living room is surrounded by shelves, which had been filled with clocks. As there is not enough room for so many clocks, the man filled several trunks and stored them in the garage. His wife complains everyday about the work she has to do, for it is not easy to dust several hundred clocks. She also complains about the noise that each clock keeps its own time. She never knows exactly what time it is."
    },
    {
        "id": 10,
        "type": "fill-in-blank",
        "text": "What do people like to collect as a hobby?",
        "correctAnswer": "Stamps, books, old coins, and ancient pictures",
        "explanation": "وردت هذه الأمثلة في الجملة الأولى"
    },
    {
        "id": 11,
        "type": "fill-in-blank",
        "text": "Why does the man's wife complain?",
        "correctAnswer": "Because it's hard to clean hundreds of clocks, and they all show different times, which causes noise and confusion",
        "explanation": "هي تشتكي من النظافة والضجيج وعدم معرفة الوقت الحقيقي"
    },
    {
        "id": 12,
        "type": "fill-in-blank",
        "text": "What do you think would happen if all the clocks had the same time?",
        "correctAnswer": "The noise would be less confusing, and she would know the correct time",
        "explanation": "إذا كانت كل الساعات متطابقة، سيقل التوتر والضجيج"
    },
    {
        "id": 13,
        "type": "multiple-choice",
        "text": "The living room is surrounded by shelves which had been filled with ___",
        "options": [
            { "id": 1, "text": "books", "correct": false },
            { "id": 2, "text": "clocks", "correct": true },
            { "id": 3, "text": "flowers", "correct": false },
            { "id": 4, "text": "newspapers", "correct": false }
        ],
        "explanation": "'filled with clocks' ورد في النص"
    },
    {
        "id": 14,
        "type": "multiple-choice",
        "text": "The man has put the clocks ___",
        "options": [
            { "id": 1, "text": "in one room", "correct": false },
            { "id": 2, "text": "in the garage only", "correct": false },
            { "id": 3, "text": "in different places", "correct": true },
            { "id": 4, "text": "in some rooms", "correct": false }
        ],
        "explanation": "في كل غرفة، وعلى الرفوف، وفي صناديق بالجراج"
    },
    {
        "id": 15,
        "type": "multiple-choice",
        "text": "The word 'several' means ___",
        "options": [
            { "id": 1, "text": "large", "correct": false },
            { "id": 2, "text": "little", "correct": false },
            { "id": 3, "text": "many", "correct": true },
            { "id": 4, "text": "few", "correct": false }
        ],
        "explanation": "'several' = عدة = many (لكن أقل من 'many' قليلاً، ومع ذلك تعني 'كثير')"
    },
    {
        "id": 16,
        "type": "multiple-choice",
        "text": "A/an ___ can be entrance to another place.",
        "options": [
            { "id": 1, "text": "arch", "correct": true },
            { "id": 2, "text": "wall", "correct": false },
            { "id": 3, "text": "ruin", "correct": false },
            { "id": 4, "text": "castle", "correct": false }
        ],
        "explanation": "القوس (arch) يمكن أن يكون مدخلًا إلى مكان آخر"
    },
    {
        "id": 17,
        "type": "multiple-choice",
        "text": "You can watch a sports match at a ___",
        "options": [
            { "id": 1, "text": "museum", "correct": false },
            { "id": 2, "text": "library", "correct": false },
            { "id": 3, "text": "stadium", "correct": true },
            { "id": 4, "text": "castle", "correct": false }
        ],
        "explanation": "المباريات تُلعب في الملاعب (stadium)"
    },
    {
        "id": 18,
        "type": "multiple-choice",
        "text": "You can pray at a ___",
        "options": [
            { "id": 1, "text": "museum", "correct": false },
            { "id": 2, "text": "mosque", "correct": true },
            { "id": 3, "text": "stadium", "correct": false },
            { "id": 4, "text": "castle", "correct": false }
        ],
        "explanation": "أماكن الصلاة هي المساجد"
    },
    {
        "id": 19,
        "type": "multiple-choice",
        "text": "You can see ___ in a museum.",
        "options": [
            { "id": 1, "text": "prayers", "correct": false },
            { "id": 2, "text": "castles", "correct": false },
            { "id": 3, "text": "statues", "correct": true },
            { "id": 4, "text": "players", "correct": false }
        ],
        "explanation": "المتاحف تعرض تماثيل وقطع أثرية"
    },
    {
        "id": 20,
        "type": "multiple-choice",
        "text": "___ are not a complete building.",
        "options": [
            { "id": 1, "text": "Ruins", "correct": true },
            { "id": 2, "text": "Castles", "correct": false },
            { "id": 3, "text": "Statues", "correct": false },
            { "id": 4, "text": "Arches", "correct": false }
        ],
        "explanation": "الأطلال (ruins) هي بقايا مباني غير مكتملة"
    },
    {
        "id": 21,
        "type": "multiple-choice",
        "text": "___ is something that is concerning history.",
        "options": [
            { "id": 1, "text": "Historic", "correct": true },
            { "id": 2, "text": "Amazing", "correct": false },
            { "id": 3, "text": "Interesting", "correct": false },
            { "id": 4, "text": "Awesome", "correct": false }
        ],
        "explanation": "'historic' = تاريخي، يتعلق بالماضي"
    },
    {
        "id": 22,
        "type": "multiple-choice",
        "text": "A ___ is a person who can show you round a place.",
        "options": [
            { "id": 1, "text": "cook", "correct": false },
            { "id": 2, "text": "waiter", "correct": false },
            { "id": 3, "text": "tourist", "correct": false },
            { "id": 4, "text": "guide", "correct": true }
        ],
        "explanation": "الدليل (guide) يُرشد الزوار"
    },
    {
        "id": 23,
        "type": "multiple-choice",
        "text": "What ___ the boys doing at 4 p.m yesterday?",
        "options": [
            { "id": 1, "text": "did", "correct": false },
            { "id": 2, "text": "are", "correct": false },
            { "id": 3, "text": "have", "correct": false },
            { "id": 4, "text": "were", "correct": true }
        ],
        "explanation": "'yesterday at 4 p.m' → زمن ماضٍ مستمر → 'were doing'"
    },
    {
        "id": 24,
        "type": "multiple-choice",
        "text": "As I was running, I ___ a nice bird.",
        "options": [
            { "id": 1, "text": "am seeing", "correct": false },
            { "id": 2, "text": "see", "correct": false },
            { "id": 3, "text": "saw", "correct": true },
            { "id": 4, "text": "sees", "correct": false }
        ],
        "explanation": "'As I was running' → حدث في الماضي → 'saw'"
    },
    {
        "id": 25,
        "type": "multiple-choice",
        "text": "___ you hear the bell while you were cooking?",
        "options": [
            { "id": 1, "text": "Did", "correct": true },
            { "id": 2, "text": "Were", "correct": false },
            { "id": 3, "text": "Do", "correct": false },
            { "id": 4, "text": "have", "correct": false }
        ],
        "explanation": "سؤال في الماضي البسيط → 'Did you hear?'"
    },
    {
        "id": 26,
        "type": "fill-in-blank",
        "text": "During an exam, you ___ copy from the other students. (must)",
        "correctAnswer": "must not / mustn't",
        "explanation": "يُمنع الغش في الامتحان"
    },
    {
        "id": 27,
        "type": "fill-in-blank",
        "text": "I ___ forget my wife's birthday, so I have to buy a card today. (must)",
        "correctAnswer": "must not / mustn't",
        "explanation": "تعبير عن التزام بعدم النسيان"
    },
    {
        "id": 28,
        "type": "fill-in-blank",
        "text": "He was painting ___ the phone rang. (while)",
        "correctAnswer": "when",
        "explanation": "'when' تُستخدم مع أفعال لحظية مثل 'rang'"
    },
    {
        "id": 29,
        "type": "fill-in-blank",
        "text": "What were you doing when ___? (phone)",
        "correctAnswer": "the phone rang",
        "explanation": "السؤال الكامل: 'What were you doing when the phone rang?'"
    }
        ]
    };

   // متغيرات
    let currentQuestionIndex = 0;
    let userAnswers = {};
    let answered = {};

    // تحميل البيانات المحفوظة
    function loadSavedData() {
        const saved = localStorage.getItem(`exam_${examId}`);
        if (saved) {
            const data = JSON.parse(saved);
            userAnswers = data.answers || {};
            currentQuestionIndex = data.currentQuestionIndex || 0;
            return true;
        }
        return false;
    }

    // حفظ البيانات
    function saveData() {
        const data = {
            answers: userAnswers,
            currentQuestionIndex: currentQuestionIndex,
            timestamp: new Date().toISOString()
        };
        localStorage.setItem(`exam_${examId}`, JSON.stringify(data));
    }

    // الحصول على رقم السؤال الحقيقي (باستثناء النصوص والشعر)
    function getQuestionNumber(index) {
        let realCount = 0;
        for (let i = 0; i <= index; i++) {
            if (examData.questions[i].type !== "passage" && examData.questions[i].type !== "poem") {
                realCount++;
            }
        }
        return realCount;
    }

    // تحديث زر التالي
    function updateNextButton() {
        const nextBtn = document.getElementById('next-btn');
        const currentQuestion = examData.questions[currentQuestionIndex];
        
        // إذا كان السؤال الحالي نصًا أو شعرًا، فعّل الزر مباشرة
        if (currentQuestion.type === "passage" || currentQuestion.type === "poem") {
            nextBtn.disabled = false;
            return;
        }
        
        // تحقق مما إذا كان السؤال الحالي قد تمت الإجابة عليه
        nextBtn.disabled = !answered[currentQuestionIndex];
    }

    // تحديد خيار في سؤال متعدد الخيارات
    function selectOption(element, questionId, optionId, isCorrect) {
        // منع التحديد إذا كانت الإجابة معروضة بالفعل
        if (userAnswers[questionId]) return;
        
        // إلغاء تحديد جميع الخيارات الأخرى
        const options = document.querySelectorAll(`.option[data-question="${questionId}"]`);
        options.forEach(opt => opt.classList.remove('selected'));
        
        // تحديد الخيار الحالي
        element.classList.add('selected');
        
        // حفظ الإجابة
        userAnswers[questionId] = {
            selected: optionId,
            correct: isCorrect
        };
        
        // تشغيل الصوت المناسب
        if (isCorrect) {
            correctSound.play();
        } else {
            incorrectSound.play();
        }
        
        // عرض التفسير
        const explanationEl = document.getElementById(`explanation-${questionId}`);
        if (explanationEl) {
            explanationEl.style.display = 'block';
        }
        
        // تمييز الإجابة الصحيحة والخاطئة
        options.forEach(opt => {
            const optCorrect = opt.getAttribute('data-correct') === 'true';
            if (optCorrect) {
                opt.classList.add('correct');
            } else if (parseInt(opt.getAttribute('data-option')) === optionId && !isCorrect) {
                opt.classList.add('incorrect');
            }
        });
        
        // تمكين زر التالي
        answered[currentQuestionIndex] = true;
        updateNextButton();
        saveData();
    }

    // معالجة إدخال الإجابة في الأسئلة المقالية
    function onFillInput(questionId) {
        const input = document.getElementById(`fill-${questionId}`);
        userAnswers[questionId] = {
            answer: input.value
        };
        
        // تمكين زر التالي إذا كان هناك إدخال
        if (input.value.trim() !== '') {
            answered[currentQuestionIndex] = true;
        } else {
            answered[currentQuestionIndex] = false;
        }
        
        updateNextButton();
        saveData();
    }

    // الانتقال إلى السؤال التالي
    function nextQuestion() {
        const currentId = examData.questions[currentQuestionIndex].id;
        document.getElementById(`question-${currentId}`).style.display = 'none';
        
        if (currentQuestionIndex < examData.questions.length - 1) {
            currentQuestionIndex++;
            const nextId = examData.questions[currentQuestionIndex].id;
            document.getElementById(`question-${nextId}`).style.display = 'block';
            
            // تحديث رقم السؤال الحالي
            document.getElementById('current-question').textContent = getQuestionNumber(currentQuestionIndex);
            
            // تمكين أو تعطيل أزرار التنقل
            document.getElementById('prev-btn').disabled = currentQuestionIndex === 0;
            
            // إذا كان السؤال تاليًا نصًا أو شعرًا، فعّل الزر مباشرة
            const nextQ = examData.questions[currentQuestionIndex];
            if (nextQ.type === "passage" || nextQ.type === "poem") {
                answered[currentQuestionIndex] = true;
                document.getElementById('next-btn').disabled = false;
            } else {
                updateNextButton();
            }
            
            saveData();
        } else {
            showResults();
        }
    }

    // الانتقال إلى السؤال السابق
    function prevQuestion() {
        const currentId = examData.questions[currentQuestionIndex].id;
        document.getElementById(`question-${currentId}`).style.display = 'none';
        
        if (currentQuestionIndex > 0) {
            currentQuestionIndex--;
            const prevId = examData.questions[currentQuestionIndex].id;
            document.getElementById(`question-${prevId}`).style.display = 'block';
            
            // تحديث رقم السؤال الحالي
            document.getElementById('current-question').textContent = getQuestionNumber(currentQuestionIndex);
            
            // تمكين أو تعطيل أزرار التنقل
            document.getElementById('prev-btn').disabled = currentQuestionIndex === 0;
            updateNextButton();
            
            saveData();
        }
    }

    // عرض النتائج
// عرض النتائج - بدون حساب الأسئلة المقالية في الدرجة
function showResults() {
    // حساب النتيجة: فقط الأسئلة متعددة الخيارات
    let correctCount = 0;
    let totalQuestions = 0;

    examData.questions.forEach(q => {
        if (q.type === "multiple-choice") {
            totalQuestions++;
            if (userAnswers[q.id] && userAnswers[q.id].correct) {
                correctCount++;
            }
        }
    });

    // حساب النسبة المئوية بناءً على الأسئلة متعددة الخيارات فقط
    const score = totalQuestions > 0 ? Math.round((correctCount / totalQuestions) * 100) : 0;

    // كلمات تشجيعية
    let feedback = "";
    if (score >= 90) feedback = "ممتاز! أحسنت، استمر على هذا النحو 🌟";
    else if (score >= 75) feedback = "جيد جدًا! أداء رائع 👏";
    else if (score >= 60) feedback = "جيد، يمكنك التحسن أكثر 💪";
    else feedback = "لا بأس، راجع الدروس وحاول مرة أخرى ❤️";

    // توصيات
    let recommendations = "";
    if (score < 60) {
        recommendations = "ننصحك بمراجعة القواعد النحوية والبلاغية، وحل المزيد من الأسئلة.";
    } else if (score < 80) {
        recommendations = "أداء جيد، ركّز على أنواع الأسئلة التي أخطأت فيها.";
    } else {
        recommendations = "أداء ممتاز! استمر في التقدم وجرّب امتحانات أصعب.";
    }

    // بناء النتائج التفصيلية
    let detailedResults = '';
    let questionNumber = 0; // رقم السؤال الحقيقي (للأسئلة القابلة للتصحيح فقط)

    examData.questions.forEach(q => {
        const userAnswer = userAnswers[q.id];
        let answerText = 'لم تُجب';
        let statusText = 'لم تُجب ❌';

        // عرض الفقرات والشعر
        if (q.type === "passage") {
            detailedResults += `
                <div class="result-item">
                    <h4>📖 فقرة نصية</h4>
                    <div class="passage">${q.content.replace(/\n/g, '<br>')}</div>
                </div>
            `;
            return;
        }

        if (q.type === "poem") {
            detailedResults += `
                <div class="result-item">
                    <h4>📜 نص شعري</h4>
                    <div class="poem">${q.content.replace(/\n/g, '<br>')}</div>
                </div>
            `;
            return;
        }

        // زيادة رقم السؤال فقط للأسئلة القابلة للتصحيح (اختيار من متعدد)
        if (q.type === "multiple-choice") {
            questionNumber++;
        }

        // معالجة الإجابة
        if (q.type === "multiple-choice") {
            const selectedOption = q.options.find(opt => opt.id == userAnswer?.selected);
            answerText = selectedOption ? selectedOption.text : 'لم تُجب';
            
            if (userAnswer && selectedOption?.correct) {
                statusText = 'إجابة صحيحة ✅';
            } else if (userAnswer && !selectedOption?.correct) {
                statusText = 'إجابة خاطئة ❌';
            } else {
                statusText = 'لم تُجب ❌';
            }
        } 
        else if (q.type === "fill-in-blank") {
            // السؤال المقالي: يظهر لكن بدون تأثير على العد
            answerText = userAnswer?.answer?.trim() || 'لم تُجب';
            statusText = (userAnswer && answerText !== 'لم تُجب') ? 'تمت الإجابة (تحت المراجعة)' : 'لم تُجب ❌';
        }

        // عرض السؤال بالشكل المطلوب
        detailedResults += `
            <div class="result-item">
                ${q.type === "multiple-choice" ? `<p><strong>السؤال ${questionNumber}: ${q.text}</strong></p>` : `<p><strong>${q.text}</strong></p>`}
                <p><strong>إجابتك:</strong> ${answerText}</p>
                <p><strong>الحالة:</strong> ${statusText}</p>
                <p><strong>📌 التفسير الكامل:</strong> ${q.explanation}</p>
            </div>
        `;
    });

    // عرض النتيجة النهائية
    document.getElementById('score').innerHTML = `
        <div class="stats">الإجابات الصحيحة: ${correctCount} من ${totalQuestions}</div>
        <div class="stats">النسبة المئوية: ${score}%</div>
        <div class="feedback">${feedback}</div>
        <div class="recommendations"><strong>توصية:</strong> ${recommendations}</div>
    `;

    document.getElementById('detailed-results').innerHTML = detailedResults;

    // إخفاء الأسئلة وإظهار النتائج
    document.getElementById('questions-container').style.display = 'none';
    document.querySelector('.navigation').style.display = 'none';
    document.querySelector('.controls').style.display = 'flex';
    document.getElementById('results-container').style.display = 'block';
}
    // طباعة النتائج
    function printResults() {
        window.print();
    }

    // مشاركة النتائج
    function shareResults() {
        if (navigator.share) {
            navigator.share({
                title: 'نتيجة الامتحان',
                text: `حصلت على ${document.getElementById('score').textContent} في امتحان اللغة العربية`,
                url: window.location.href
            })
            .catch(error => {
                console.log('Error sharing:', error);
                alert('لم يتمكن المتصفح من مشاركة النتائج. يرجى المحاولة لاحقًا.');
            });
        } else {
            alert('مشاركة النتائج غير مدعومة في هذا المتصفح. يمكنك استخدام زر الطباعة بدلاً من ذلك.');
        }
    }

    // إعادة بدء الامتحان
    function restartExam() {
        if (confirm('هل تريد إعادة بدء الامتحان؟ سيتم حذف جميع إجاباتك الحالية.')) {
            userAnswers = {};
            answered = {};
            currentQuestionIndex = 0;
            localStorage.removeItem(`exam_${examId}`);
            location.reload();
        }
    }

    // العودة إلى قائمة الامتحانات
    function backToExams() {
        if (confirm('هل تريد العودة إلى قائمة الامتحانات؟ سيتم فقدان تقدمك الحالي إذا لم تحفظه.')) {
            window.location.href = '/questions.html'; // تغيير هذا الرابط حسب الصفحة المناسبة
        }
    }

    // تهيئة الامتحان
    function initExam() {
        const container = document.getElementById('questions-container');
        const totalQuestions = examData.questions.filter(q => q.type !== "passage" && q.type !== "poem").length;
        document.getElementById('total-questions').textContent = totalQuestions;
        document.getElementById('current-question').textContent = getQuestionNumber(currentQuestionIndex);

        // تحميل الحالة
        const wasResumed = loadSavedData();

        // إنشاء الأسئلة
        examData.questions.forEach((q, index) => {
            const questionEl = document.createElement('div');
            questionEl.className = 'question';
            questionEl.id = `question-${q.id}`;
            questionEl.style.display = index === currentQuestionIndex ? 'block' : 'none';

            if (q.type === "passage") {
                questionEl.innerHTML = `<div class="passage">${q.content.replace(/\n/g, '<br>')}</div>`;
                // تمييز أسئلة النص كأسئلة تمت الإجابة عليها تلقائيًا
                answered[index] = false;
            } else if (q.type === "poem") {
                questionEl.innerHTML = `<div class="poem">${q.content.replace(/\n/g, '<br>')}</div>`;
                // تمييز أسئلة الشعر كأسئلة تمت الإجابة عليها تلقائيًا
                answered[index] = false;
            } else {
                let content = `<h3>السؤال ${getQuestionNumber(index)}: ${q.text}</h3>`;

                if (q.type === "multiple-choice") {
                    let optionsHtml = '<div class="options">';
                    q.options.forEach(opt => {
                        const selected = userAnswers[q.id]?.selected == opt.id;
                        const isAnswered = userAnswers[q.id];
                        const correct = opt.correct;
                        optionsHtml += `
                            <div class="option ${selected ? 'selected' : ''} ${isAnswered && correct ? 'correct' : ''} ${isAnswered && !correct && selected ? 'incorrect' : ''}"
                                 data-question="${q.id}" data-option="${opt.id}" data-correct="${opt.correct}"
                                 onclick="selectOption(this, ${q.id}, ${opt.id}, ${opt.correct})">
                                ${opt.text}
                            </div>
                        `;
                    });
                    optionsHtml += '</div>';
                    content += optionsHtml;
                } else if (q.type === "fill-in-blank") {
                    const value = userAnswers[q.id]?.answer || '';
                    content += `
                        <div class="fill-in-blank">
                            <input type="text" id="fill-${q.id}" value="${value}" placeholder="أدخل إجابتك هنا" oninput="onFillInput(${q.id})">
                        </div>
                    `;
                }

                content += `<div class="explanation" id="explanation-${q.id}" style="${userAnswers[q.id] ? 'display:block' : 'display:none'}">
                    <strong>التفسير:</strong> ${q.explanation}
                </div>`;
                questionEl.innerHTML = content;
                
                // تحديد ما إذا كان السؤال قد تمت الإجابة عليه
                answered[index] = !!userAnswers[q.id];
            }

            container.appendChild(questionEl);
        });

        // تحديث زر التالي بناءً على السؤال الحالي
        updateNextButton();

        // ربط الأحداث
        document.getElementById('next-btn').addEventListener('click', nextQuestion);
        document.getElementById('prev-btn').addEventListener('click', prevQuestion);
        document.getElementById('print-btn').addEventListener('click', printResults);
        document.getElementById('share-btn').addEventListener('click', shareResults);
        document.getElementById('restart-btn').addEventListener('click', restartExam);
        document.getElementById('back-btn').addEventListener('click', backToExams);

        if (wasResumed) {
            alert(`تم استئناف الامتحان من السؤال ${getQuestionNumber(currentQuestionIndex)}`);
        }
    }

    // بدء الامتحان عند تحميل الصفحة
    window.onload = initExam;
</script>
</body>
</html>