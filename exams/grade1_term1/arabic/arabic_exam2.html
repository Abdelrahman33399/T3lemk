<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>اختبار اللغة العربية - الصف الاول الإعدادي</title>
    <link rel="stylesheet" href="../../css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* أنماط عامة */
        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        
        /* الحاوية الرئيسية */
        .exam-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
        }
        
        /* رأس الامتحان */
        .exam-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #007bff;
        }
        
        .exam-header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        /* إحصائيات الأسئلة */
        .stats {
            background: #e9f5ff;
            padding: 10px 15px;
            border-radius: 5px;
            margin: 15px 0;
            font-weight: bold;
            text-align: center;
            border-right: 4px solid #007bff;
        }
        
        /* الأسئلة */
        .question {
            margin-bottom: 25px;
            padding: 20px;
            border: 1px solid #eee;
            border-radius: 8px;
            background-color: #fafafa;
            transition: all 0.3s ease;
        }
        
        .question:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .question h3 {
            color: #007bff;
            margin-top: 0;
            padding-bottom: 10px;
            border-bottom: 1px dashed #ddd;
        }
        
        /* النصوص والقصائد */
        .passage, .poem {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            line-height: 1.8;
            font-style: italic;
            border-right: 4px solid #6c757d;
        }
        
        .poem {
            text-align: center;
            font-weight: bold;
            background: #fff9e6;
            border-right-color: #ffc107;
        }
        
        /* خيارات الأسئلة */
        .options {
            margin: 20px 0;
        }
        
        .option {
            margin-bottom: 10px;
            padding: 12px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid #e0e0e0;
            background: white;
        }
        
        .option:hover {
            background-color: #e9f5ff;
            transform: translateX(-5px);
        }
        
        .option.selected {
            background-color: #d4edff;
            border-left: 4px solid #007bff;
        }
        
        .option.correct {
            background-color: #d4edda;
            border-left: 4px solid #28a745;
        }
        
        .option.incorrect {
            background-color: #f8d7da;
            border-left: 4px solid #dc3545;
        }
        
        /* شرح الإجابة */
        .explanation {
            display: none;
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
            border-right: 3px solid #6c757d;
        }
        
        /* حقول الإدخال */
        .fill-in-blank input {
            width: 100%;
            padding: 12px;
            margin: 15px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
            transition: border 0.3s;
        }
        
        .fill-in-blank input:focus {
            border-color: #007bff;
            outline: none;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
        }
        
        /* التنقل بين الأسئلة */
        .navigation {
            display: flex;
            justify-content: space-between;
            margin: 30px 0;
        }
        
        /* الأزرار */
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 16px;
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .btn-primary {
            background-color: #007bff;
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            background-color: #0069d9;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover:not(:disabled) {
            background-color: #5a6268;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background-color: #28a745;
            color: white;
        }
        
        .btn-success:hover:not(:disabled) {
            background-color: #218838;
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background-color: #dc3545;
            color: white;
        }
        
        .btn-danger:hover:not(:disabled) {
            background-color: #c82333;
            transform: translateY(-2px);
        }
        
        .btn-warning {
            background-color: #ffc107;
            color: #212529;
        }
        
        .btn-warning:hover:not(:disabled) {
            background-color: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-info {
            background-color: #17a2b8;
            color: white;
        }
        
        .btn-info:hover:not(:disabled) {
            background-color: #138496;
            transform: translateY(-2px);
        }
        
        /* النتائج */
        .results-container {
            display: none;
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .score {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            margin: 20px 0;
            color: #007bff;
        }
        
        .feedback {
            text-align: center;
            font-size: 18px;
            margin: 15px 0;
            color: #28a745;
            font-weight: bold;
        }
        
        .result-item {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 8px;
            background-color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .recommendations {
            background-color: #fff3cd;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid #ffeaa7;
        }
        
        .correct-answer {
            color: #28a745;
            font-weight: bold;
        }
        
        /* عناصر التحكم */
        .controls {
            margin-top: 30px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        /* التكيف مع الشاشات الصغيرة */
        @media (max-width: 768px) {
            .exam-container {
                padding: 15px;
            }
            
            .navigation {
                flex-direction: column;
                gap: 10px;
            }
            
            .btn {
                width: 100%;
                margin-bottom: 5px;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .question {
                padding: 15px;
            }
            
            .passage, .poem {
                padding: 15px;
            }
        }
    </style></head>
<body>
    <div class="exam-container">
        <div class="exam-header">
            <h1 id="exam-title">اختبار اللغة العربية - الصف الاول الإعدادي (الوحدة الأولي) - الترم الأول</h1>
        </div>
        
        <div class="stats">السؤال <span id="current-question">1</span> من <span id="total-questions">22</span></div>
        
        <div id="questions-container"></div>
        
        <div class="navigation">
            <button id="prev-btn" class="btn btn-secondary" disabled>السابق</button>
            <button id="next-btn" class="btn btn-primary">التالي</button>
        </div>
        
        <div class="controls">
            <button id="restart-btn" class="btn btn-warning">إعادة البدء</button>
            <button id="print-btn" class="btn btn-info">طباعة النتائج</button>
            <button id="share-btn" class="btn btn-success">مشاركة النتائج</button>
            <button id="back-btn" class="btn btn-danger">العودة للامتحانات</button>
        </div>
        
        <div class="results-container" id="results-container">
            <h2>النتيجة</h2>
            <div id="score"></div>
            <div id="detailed-results"></div>
        </div>
    </div>

    <audio id="correctSound" src="../../../assets/audio/correct.mp3" preload="auto"></audio>
    <audio id="incorrectSound" src="../../../assets/audio/incorrect.mp3" preload="auto"></audio>


   <script>
    // أصوات
    const correctSound = document.getElementById('correctSound');
    const incorrectSound = document.getElementById('incorrectSound');

    // معرف الامتحان
    const examId = "arabic-grade2-term1";

    // بيانات الأسئلة (كما أرسلتها)
    const examData = {
        title: "اختبار اللغة العربية - الصف الاول الإعدادي (الوحدة الأولي) - الترم الأول",
        questions: [
            {
                "id": 1,
                "type": "passage",
                "content": "المرأة المصرية هي جوهرة متألقة في تاريخ مصر العريق، حيث كانت وما زالت تمثل قوة فاعلة في بناء المجتمع وصياغة مستقبله، متجسدة في أدوار متعددة تعكس عظمتها وعمق تأثيرها في مختلف جوانب الحياة. فمنذ فجر الحضارة المصرية القديمة، لم تكن مجرد عنصر مكمل، بل كانت قوة دافعة ومؤثرة في مسار الأحداث، شغلت أرفع المناصب وساهمت بفاعلية في ازدهار بلادها، ما جعلها تحظى بمكانة مرموقة لم تنلها نظيراتها في كثير من الحضارات الأخرى، ولم تقتصر مكانتها على كونها شريكة في الحياة، بل كانت قائدة وسيدة قرار، يشار إليها بالبنان لما امتلكته من حكمة وحنكة سياسية، إن المرأة المصرية ستظل رمزا للعطاء الذي لا ينفد."
            },
            {
                "id": 2,
                "type": "multiple-choice",
                "text": "ما معنى كلمة 'ينفد' في العبارة: 'العطاء الذي لا ينفد'؟",
                "options": [
                    { "id": 1, "text": "يظل", "correct": false },
                    { "id": 2, "text": "يبقى", "correct": false },
                    { "id": 3, "text": "يبدأ", "correct": false },
                    { "id": 4, "text": "ينتهي", "correct": true }
                ],
                "explanation": "'ينفد' تعني تنتهي أو تضيع، لذا فإن 'العطاء الذي لا ينفد' يعني عطاء مستمر لا ينقطع."
            },
            {
                "id": 3,
                "type": "multiple-choice",
                "text": "ما مفرد كلمة 'البنان' في الجملة: 'يشار إليها بالبنان'؟",
                "options": [
                    { "id": 1, "text": "بناة", "correct": false },
                    { "id": 2, "text": "بنانة", "correct": true },
                    { "id": 3, "text": "بنية", "correct": false },
                    { "id": 4, "text": "بنوة", "correct": false }
                ],
                "explanation": "'البنان' جمع 'بنانة'، وتُستخدم للإشارة إلى الأصابع أو الرفعة والمكانة."
            },
            {
                "id": 4,
                "type": "multiple-choice",
                "text": "ما مضاد كلمة 'مرموقة' في الجملة: 'مكانة مرموقة'؟",
                "options": [
                    { "id": 1, "text": "مغمورة", "correct": true },
                    { "id": 2, "text": "وضيعة", "correct": true },
                    { "id": 3, "text": "حقيرة", "correct": true },
                    { "id": 4, "text": "جميع ما سبق", "correct": true }
                ],
                "explanation": "جميع الخيارات الثلاثة (مغمورة، وضيعة، حقيرة) تعني نقيض 'المرموقة'، لذا فإن الإجابة الصحيحة هي 'جميع ما سبق'."
            },
            {
                "id": 5,
                "type": "fill-in-blank",
                "text": "دلل على صدق العبارة: 'لم تكن المرأة المصرية القديمة عنصرًا مكملًا، بل كانت قوة دافعة ومؤثرة في مسار الأحداث'.",
                "correctAnswer": "مثلًا: شغلت مناصب عالية مثل الملكة حتشبسوت التي حكمت كفرعون، وشاركت في الإدارة والدين والاقتصاد، مما يدل على دورها الفاعل.",
                "explanation": "الدليل يظهر في مشاركتها في المناصب القيادية، مثل الحكم والكهنوت، مما يثبت تأثيرها الكبير في الحضارة المصرية."
            },
            {
                "id": 6,
                "type": "poem",
                "content": "بني مصر ، صونوا لها حقها\nكبار النفوس كبار الشيم\nلكم مصر لا لدعي دعا\nولا لذوي سطوة أو غشم\nلكم مصر حيث يقر الثرى\nوحيث يرف عليها العلم"
            },
            {
                "id": 7,
                "type": "multiple-choice",
                "text": "ما معنى كلمة 'سطوة' في البيت: 'ولا لذوي سطوة أو غشم'؟",
                "options": [
                    { "id": 1, "text": "قوة", "correct": true },
                    { "id": 2, "text": "شجاعة", "correct": false },
                    { "id": 3, "text": "إرادة", "correct": false },
                    { "id": 4, "text": "قسوة", "correct": false }
                ],
                "explanation": "'السطوة' تعني القوة والجبروت، وغالبًا ما تُستخدم بمعنى السيطرة أو الهيمنة."
            },
            {
                "id": 8,
                "type": "multiple-choice",
                "text": "ما مفرد كلمة 'الشيم' في البيت: 'كبار النفوس كبار الشيم'؟",
                "options": [
                    { "id": 1, "text": "الشامة", "correct": false },
                    { "id": 2, "text": "الشيمة", "correct": true },
                    { "id": 3, "text": "الشمة", "correct": false },
                    { "id": 4, "text": "الشومة", "correct": false }
                ],
                "explanation": "'الشيم' جمع 'شيمة'، وتعني الأخلاق الفاضلة أو الصفات الحميدة."
            },
            {
                "id": 9,
                "type": "multiple-choice",
                "text": "ما مضاد كلمة 'يرف' في البيت: 'وحيث يرف عليها العلم'؟",
                "options": [
                    { "id": 1, "text": "يتحرك", "correct": false },
                    { "id": 2, "text": "يهتز", "correct": false },
                    { "id": 3, "text": "يثبت", "correct": true },
                    { "id": 4, "text": "يسعد", "correct": false }
                ],
                "explanation": "'يرف' تعني يهتز أو يخفق، ومضادها 'يثبت' أو يستقر."
            },
            {
                "id": 10,
                "type": "fill-in-blank",
                "text": "إلام يدعو الشاعر الأبناء في مصر؟",
                "correctAnswer": "يدعوهم لصون حق مصر والحفاظ على كرامتها وعدم تركها للطامعين أو الظالمين.",
                "explanation": "الشاعر يحث الشباب على الوفاء لوطنهم وعدم التفريط فيه أمام الطامعين أو ذوي القوة الظالمة."
            },
            {
                "id": 11,
                "type": "fill-in-blank",
                "text": "ما العاطفة المسيطرة على الشاعر في النص الشعري؟",
                "correctAnswer": "عاطفة الحب الوطني والانتماء والدفاع عن الوطن.",
                "explanation": "الشاعر يعبر عن فخره بمصر ويدعو أبناءها للدفاع عنها، مما يدل على عاطفة وطنية عميقة."
            },
            {
                "id": 12,
                "type": "fill-in-blank",
                "text": "استخرج من البيت الأول تشبيهًا، واشرحه، مبينًا قيمته.",
                "correctAnswer": "التشبيه: 'كبار النفوس كبار الشيم' — شُبّهت النفوس الكبيرة بالشيم العظيمة، والقيمة: توكيد أن العظمة الحقيقية تأتي من الأخلاق لا من المكانة.",
                "explanation": "التشبيه يربط بين عظمة النفس وعِظم الأخلاق، ويُظهر أن الأصل في العظمة هو الخلق، وليس النسب أو القوة."
            },
            {
                "id": 13,
                "type": "fill-in-blank",
                "text": "تخيل أن الدكتور مصطفى السيد يكتب سيرته الذاتية، فماذا يكتب مراعيًا عناصر السيرة؟",
                "correctAnswer": "يكتب: اسمه، تاريخ الميلاد، مكان الميلاد، المؤهلات العلمية، إنجازاته (مثل اختراع النانو جول)، الجامعات التي عمل بها، الجوائز، والرسالة التي يوجهها للشباب.",
                "explanation": "السيرة الذاتية تتضمن المعلومات الشخصية، التعليمية، المهنية، والإنجازات البارزة بطريقة منظمة."
            },
            {
                "id": 14,
                "type": "passage",
                "content": "بالرغم من الإنجازات العظيمة التي حققتها المرأة المصرية، لا تزال تواجه تحديات تشكل عقبة أمام تحقيق إمكاناتها الكاملة، منها بعض العادات والتقاليد السلبية التي تحد من فرصها في التعليم والعمل والمشاركة المجتمعية، إضافة إلى قضية العنف الأسري، الذي يشكل تهديدا خطيرًا لاستقرارها وأمانها النفسي والجسدي."
            },
            {
                "id": 15,
                "type": "multiple-choice",
                "text": "ما إعراب كلمة 'المرأة' في الجملة: 'المرأة المصرية حققت إنجازات عظيمة'؟",
                "options": [
                    { "id": 1, "text": "مبتدأ مرفوع وعلامة رفعه الضمة", "correct": true },
                    { "id": 2, "text": "خبر مرفوع وعلامة رفعه الضمة", "correct": false },
                    { "id": 3, "text": "فاعل مرفوع وعلامة رفعه الضمة", "correct": false },
                    { "id": 4, "text": "نائب فاعل منصوب", "correct": false }
                ],
                "explanation": "'المرأة' هي مبتدأ في الجملة الاسمية، وخبرها 'حققت إنجازات عظيمة'."
            },
            {
                "id": 16,
                "type": "multiple-choice",
                "text": "ما إعراب كلمة 'العنف' في الجملة: 'العنف الأسري يهدد الأسرة'؟",
                "options": [
                    { "id": 1, "text": "مبتدأ مرفوع", "correct": true },
                    { "id": 2, "text": "نعت منصوب", "correct": false },
                    { "id": 3, "text": "مضاف منصوب", "correct": false },
                    { "id": 4, "text": "مفعول به منصوب", "correct": false }
                ],
                "explanation": "'العنف' مبتدأ، وخبره 'يهدد الأسرة'، والجملة خبرية."
            },
            {
                "id": 17,
                "type": "fill-in-blank",
                "text": "استخرج من الفقرة فعلاً لازمًا، وبين فاعله.",
                "correctAnswer": "الفعل: 'تشكل'، فاعله: 'بعض العادات والتقاليد السلبية'.",
                "explanation": "'تشكل' فعل لازم لأنه لا يحتاج إلى مفعول به مباشر، وفاعله ضمير مستتر أو الاسم السابق."
            },
            {
                "id": 18,
                "type": "fill-in-blank",
                "text": "استخرج من الفقرة فعلاً متعديًا.",
                "correctAnswer": "مثلاً: 'تحد' — تُعد فعلًا متعديًا لأنها تحتاج إلى مفعول به (تحد من فرصها).",
                "explanation": "الفعل المتعدي يحتاج إلى مفعول به ليتم معناه، مثل 'تحد' و'تواجه'."
            },
            {
                "id": 19,
                "type": "fill-in-blank",
                "text": "استخرج من الفقرة فعلاً مجردًا.",
                "correctAnswer": "مثلاً: 'حققت' — فعل ماضٍ مبني على الفتح، وهو فعل مجرد (أصله ثلاثي).",
                "explanation": "الفعل المجرد هو الفعل الثلاثي غير المزيد، مثل: حقق، واجه، حدّ."
            },
            {
                "id": 20,
                "type": "fill-in-blank",
                "text": "استخرج من الفقرة فعلاً مزيدًا، واذكر حروف الزيادة.",
                "correctAnswer": "مثلاً: 'تواجه' — فعل مزيد (وزنه تَفْعَل)، حروف الزيادة: تاء المبني للمعلوم وفاء التضعيف.",
                "explanation": "الفعل المزيد هو ما زيدت عليه حروف مثل التاء أو الشين، و'تواجه' من وزن 'تَفْعَل'."
            },
            {
                "id": 21,
                "type": "multiple-choice",
                "text": "في الجملة: 'نحن نعمل باجتهاد لترفع راية وطننا'، الفعلان بالترتيب هما:",
                "options": [
                    { "id": 1, "text": "متعدٍ، متعدٍ", "correct": false },
                    { "id": 2, "text": "لازم، لازم", "correct": false },
                    { "id": 3, "text": "متعدٍ، لازم", "correct": false },
                    { "id": 4, "text": "لازم، متعدٍ", "correct": true }
                ],
                "explanation": "'نعمل' فعل لازم (لا يتعدى إلى مفعول به)، و'ترفع' فعل متعدٍ (يتعدى إلى 'راية')."
            },
            {
                "id": 22,
                "type": "fill-in-blank",
                "text": "صوب الخطأ في الجملة: 'من خلال التؤمل في الكون اكتشف العلماء أسرار الكون.'",
                "correctAnswer": "من خلال التأمل في الكون اكتشف العلماء أسرار الكون.",
                "explanation": "الصواب: 'التأمل' وليس 'التؤمل'، لأن 'تأمل' مصدر من الفعل 'تأمل'، والهمز بدل الواو."
            }
        ]
    };

   // متغيرات
    let currentQuestionIndex = 0;
    let userAnswers = {};
    let answered = {};

    // تحميل البيانات المحفوظة
    function loadSavedData() {
        const saved = localStorage.getItem(`exam_${examId}`);
        if (saved) {
            const data = JSON.parse(saved);
            userAnswers = data.answers || {};
            currentQuestionIndex = data.currentQuestionIndex || 0;
            return true;
        }
        return false;
    }

    // حفظ البيانات
    function saveData() {
        const data = {
            answers: userAnswers,
            currentQuestionIndex: currentQuestionIndex,
            timestamp: new Date().toISOString()
        };
        localStorage.setItem(`exam_${examId}`, JSON.stringify(data));
    }

    // الحصول على رقم السؤال الحقيقي (باستثناء النصوص والشعر)
    function getQuestionNumber(index) {
        let realCount = 0;
        for (let i = 0; i <= index; i++) {
            if (examData.questions[i].type !== "passage" && examData.questions[i].type !== "poem") {
                realCount++;
            }
        }
        return realCount;
    }

    // تحديث زر التالي
    function updateNextButton() {
        const nextBtn = document.getElementById('next-btn');
        const currentQuestion = examData.questions[currentQuestionIndex];
        
        // إذا كان السؤال الحالي نصًا أو شعرًا، فعّل الزر مباشرة
        if (currentQuestion.type === "passage" || currentQuestion.type === "poem") {
            nextBtn.disabled = false;
            return;
        }
        
        // تحقق مما إذا كان السؤال الحالي قد تمت الإجابة عليه
        nextBtn.disabled = !answered[currentQuestionIndex];
    }

    // تحديد خيار في سؤال متعدد الخيارات
    function selectOption(element, questionId, optionId, isCorrect) {
        // منع التحديد إذا كانت الإجابة معروضة بالفعل
        if (userAnswers[questionId]) return;
        
        // إلغاء تحديد جميع الخيارات الأخرى
        const options = document.querySelectorAll(`.option[data-question="${questionId}"]`);
        options.forEach(opt => opt.classList.remove('selected'));
        
        // تحديد الخيار الحالي
        element.classList.add('selected');
        
        // حفظ الإجابة
        userAnswers[questionId] = {
            selected: optionId,
            correct: isCorrect
        };
        
        // تشغيل الصوت المناسب
        if (isCorrect) {
            correctSound.play();
        } else {
            incorrectSound.play();
        }
        
        // عرض التفسير
        const explanationEl = document.getElementById(`explanation-${questionId}`);
        if (explanationEl) {
            explanationEl.style.display = 'block';
        }
        
        // تمييز الإجابة الصحيحة والخاطئة
        options.forEach(opt => {
            const optCorrect = opt.getAttribute('data-correct') === 'true';
            if (optCorrect) {
                opt.classList.add('correct');
            } else if (parseInt(opt.getAttribute('data-option')) === optionId && !isCorrect) {
                opt.classList.add('incorrect');
            }
        });
        
        // تمكين زر التالي
        answered[currentQuestionIndex] = true;
        updateNextButton();
        saveData();
    }

    // معالجة إدخال الإجابة في الأسئلة المقالية
    function onFillInput(questionId) {
        const input = document.getElementById(`fill-${questionId}`);
        userAnswers[questionId] = {
            answer: input.value
        };
        
        // تمكين زر التالي إذا كان هناك إدخال
        if (input.value.trim() !== '') {
            answered[currentQuestionIndex] = true;
        } else {
            answered[currentQuestionIndex] = false;
        }
        
        updateNextButton();
        saveData();
    }

    // الانتقال إلى السؤال التالي
    function nextQuestion() {
        const currentId = examData.questions[currentQuestionIndex].id;
        document.getElementById(`question-${currentId}`).style.display = 'none';
        
        if (currentQuestionIndex < examData.questions.length - 1) {
            currentQuestionIndex++;
            const nextId = examData.questions[currentQuestionIndex].id;
            document.getElementById(`question-${nextId}`).style.display = 'block';
            
            // تحديث رقم السؤال الحالي
            document.getElementById('current-question').textContent = getQuestionNumber(currentQuestionIndex);
            
            // تمكين أو تعطيل أزرار التنقل
            document.getElementById('prev-btn').disabled = currentQuestionIndex === 0;
            
            // إذا كان السؤال تاليًا نصًا أو شعرًا، فعّل الزر مباشرة
            const nextQ = examData.questions[currentQuestionIndex];
            if (nextQ.type === "passage" || nextQ.type === "poem") {
                answered[currentQuestionIndex] = true;
                document.getElementById('next-btn').disabled = false;
            } else {
                updateNextButton();
            }
            
            saveData();
        } else {
            showResults();
        }
    }

    // الانتقال إلى السؤال السابق
    function prevQuestion() {
        const currentId = examData.questions[currentQuestionIndex].id;
        document.getElementById(`question-${currentId}`).style.display = 'none';
        
        if (currentQuestionIndex > 0) {
            currentQuestionIndex--;
            const prevId = examData.questions[currentQuestionIndex].id;
            document.getElementById(`question-${prevId}`).style.display = 'block';
            
            // تحديث رقم السؤال الحالي
            document.getElementById('current-question').textContent = getQuestionNumber(currentQuestionIndex);
            
            // تمكين أو تعطيل أزرار التنقل
            document.getElementById('prev-btn').disabled = currentQuestionIndex === 0;
            updateNextButton();
            
            saveData();
        }
    }

    // عرض النتائج
// عرض النتائج - بدون حساب الأسئلة المقالية في الدرجة
function showResults() {
    // حساب النتيجة: فقط الأسئلة متعددة الخيارات
    let correctCount = 0;
    let totalQuestions = 0;

    examData.questions.forEach(q => {
        if (q.type === "multiple-choice") {
            totalQuestions++;
            if (userAnswers[q.id] && userAnswers[q.id].correct) {
                correctCount++;
            }
        }
    });

    // حساب النسبة المئوية بناءً على الأسئلة متعددة الخيارات فقط
    const score = totalQuestions > 0 ? Math.round((correctCount / totalQuestions) * 100) : 0;

    // كلمات تشجيعية
    let feedback = "";
    if (score >= 90) feedback = "ممتاز! أحسنت، استمر على هذا النحو 🌟";
    else if (score >= 75) feedback = "جيد جدًا! أداء رائع 👏";
    else if (score >= 60) feedback = "جيد، يمكنك التحسن أكثر 💪";
    else feedback = "لا بأس، راجع الدروس وحاول مرة أخرى ❤️";

    // توصيات
    let recommendations = "";
    if (score < 60) {
        recommendations = "ننصحك بمراجعة القواعد النحوية والبلاغية، وحل المزيد من الأسئلة.";
    } else if (score < 80) {
        recommendations = "أداء جيد، ركّز على أنواع الأسئلة التي أخطأت فيها.";
    } else {
        recommendations = "أداء ممتاز! استمر في التقدم وجرّب امتحانات أصعب.";
    }

    // بناء النتائج التفصيلية
    let detailedResults = '';
    let questionNumber = 0; // رقم السؤال الحقيقي (للأسئلة القابلة للتصحيح فقط)

    examData.questions.forEach(q => {
        const userAnswer = userAnswers[q.id];
        let answerText = 'لم تُجب';
        let statusText = 'لم تُجب ❌';

        // عرض الفقرات والشعر
        if (q.type === "passage") {
            detailedResults += `
                <div class="result-item">
                    <h4>📖 فقرة نصية</h4>
                    <div class="passage">${q.content.replace(/\n/g, '<br>')}</div>
                </div>
            `;
            return;
        }

        if (q.type === "poem") {
            detailedResults += `
                <div class="result-item">
                    <h4>📜 نص شعري</h4>
                    <div class="poem">${q.content.replace(/\n/g, '<br>')}</div>
                </div>
            `;
            return;
        }

        // زيادة رقم السؤال فقط للأسئلة القابلة للتصحيح (اختيار من متعدد)
        if (q.type === "multiple-choice") {
            questionNumber++;
        }

        // معالجة الإجابة
        if (q.type === "multiple-choice") {
            const selectedOption = q.options.find(opt => opt.id == userAnswer?.selected);
            answerText = selectedOption ? selectedOption.text : 'لم تُجب';
            
            if (userAnswer && selectedOption?.correct) {
                statusText = 'إجابة صحيحة ✅';
            } else if (userAnswer && !selectedOption?.correct) {
                statusText = 'إجابة خاطئة ❌';
            } else {
                statusText = 'لم تُجب ❌';
            }
        } 
        else if (q.type === "fill-in-blank") {
            // السؤال المقالي: يظهر لكن بدون تأثير على العد
            answerText = userAnswer?.answer?.trim() || 'لم تُجب';
            statusText = (userAnswer && answerText !== 'لم تُجب') ? 'تمت الإجابة (تحت المراجعة)' : 'لم تُجب ❌';
        }

        // عرض السؤال بالشكل المطلوب
        detailedResults += `
            <div class="result-item">
                ${q.type === "multiple-choice" ? `<p><strong>السؤال ${questionNumber}: ${q.text}</strong></p>` : `<p><strong>${q.text}</strong></p>`}
                <p><strong>إجابتك:</strong> ${answerText}</p>
                <p><strong>الحالة:</strong> ${statusText}</p>
                <p><strong>📌 التفسير الكامل:</strong> ${q.explanation}</p>
            </div>
        `;
    });

    // عرض النتيجة النهائية
    document.getElementById('score').innerHTML = `
        <div class="stats">الإجابات الصحيحة: ${correctCount} من ${totalQuestions}</div>
        <div class="stats">النسبة المئوية: ${score}%</div>
        <div class="feedback">${feedback}</div>
        <div class="recommendations"><strong>توصية:</strong> ${recommendations}</div>
    `;

    document.getElementById('detailed-results').innerHTML = detailedResults;

    // إخفاء الأسئلة وإظهار النتائج
    document.getElementById('questions-container').style.display = 'none';
    document.querySelector('.navigation').style.display = 'none';
    document.querySelector('.controls').style.display = 'flex';
    document.getElementById('results-container').style.display = 'block';
}
    // طباعة النتائج
    function printResults() {
        window.print();
    }

    // مشاركة النتائج
    function shareResults() {
        if (navigator.share) {
            navigator.share({
                title: 'نتيجة الامتحان',
                text: `حصلت على ${document.getElementById('score').textContent} في امتحان اللغة العربية`,
                url: window.location.href
            })
            .catch(error => {
                console.log('Error sharing:', error);
                alert('لم يتمكن المتصفح من مشاركة النتائج. يرجى المحاولة لاحقًا.');
            });
        } else {
            alert('مشاركة النتائج غير مدعومة في هذا المتصفح. يمكنك استخدام زر الطباعة بدلاً من ذلك.');
        }
    }

    // إعادة بدء الامتحان
    function restartExam() {
        if (confirm('هل تريد إعادة بدء الامتحان؟ سيتم حذف جميع إجاباتك الحالية.')) {
            userAnswers = {};
            answered = {};
            currentQuestionIndex = 0;
            localStorage.removeItem(`exam_${examId}`);
            location.reload();
        }
    }

    // العودة إلى قائمة الامتحانات
    function backToExams() {
        if (confirm('هل تريد العودة إلى قائمة الامتحانات؟ سيتم فقدان تقدمك الحالي إذا لم تحفظه.')) {
            window.location.href = '/exam.html'; // تغيير هذا الرابط حسب الصفحة المناسبة
        }
    }

    // تهيئة الامتحان
    function initExam() {
        const container = document.getElementById('questions-container');
        const totalQuestions = examData.questions.filter(q => q.type !== "passage" && q.type !== "poem").length;
        document.getElementById('total-questions').textContent = totalQuestions;
        document.getElementById('current-question').textContent = getQuestionNumber(currentQuestionIndex);

        // تحميل الحالة
        const wasResumed = loadSavedData();

        // إنشاء الأسئلة
        examData.questions.forEach((q, index) => {
            const questionEl = document.createElement('div');
            questionEl.className = 'question';
            questionEl.id = `question-${q.id}`;
            questionEl.style.display = index === currentQuestionIndex ? 'block' : 'none';

            if (q.type === "passage") {
                questionEl.innerHTML = `<div class="passage">${q.content.replace(/\n/g, '<br>')}</div>`;
                // تمييز أسئلة النص كأسئلة تمت الإجابة عليها تلقائيًا
                answered[index] = false;
            } else if (q.type === "poem") {
                questionEl.innerHTML = `<div class="poem">${q.content.replace(/\n/g, '<br>')}</div>`;
                // تمييز أسئلة الشعر كأسئلة تمت الإجابة عليها تلقائيًا
                answered[index] = false;
            } else {
                let content = `<h3>السؤال ${getQuestionNumber(index)}: ${q.text}</h3>`;

                if (q.type === "multiple-choice") {
                    let optionsHtml = '<div class="options">';
                    q.options.forEach(opt => {
                        const selected = userAnswers[q.id]?.selected == opt.id;
                        const isAnswered = userAnswers[q.id];
                        const correct = opt.correct;
                        optionsHtml += `
                            <div class="option ${selected ? 'selected' : ''} ${isAnswered && correct ? 'correct' : ''} ${isAnswered && !correct && selected ? 'incorrect' : ''}"
                                 data-question="${q.id}" data-option="${opt.id}" data-correct="${opt.correct}"
                                 onclick="selectOption(this, ${q.id}, ${opt.id}, ${opt.correct})">
                                ${opt.text}
                            </div>
                        `;
                    });
                    optionsHtml += '</div>';
                    content += optionsHtml;
                } else if (q.type === "fill-in-blank") {
                    const value = userAnswers[q.id]?.answer || '';
                    content += `
                        <div class="fill-in-blank">
                            <input type="text" id="fill-${q.id}" value="${value}" placeholder="أدخل إجابتك هنا" oninput="onFillInput(${q.id})">
                        </div>
                    `;
                }

                content += `<div class="explanation" id="explanation-${q.id}" style="${userAnswers[q.id] ? 'display:block' : 'display:none'}">
                    <strong>التفسير:</strong> ${q.explanation}
                </div>`;
                questionEl.innerHTML = content;
                
                // تحديد ما إذا كان السؤال قد تمت الإجابة عليه
                answered[index] = !!userAnswers[q.id];
            }

            container.appendChild(questionEl);
        });

        // تحديث زر التالي بناءً على السؤال الحالي
        updateNextButton();

        // ربط الأحداث
        document.getElementById('next-btn').addEventListener('click', nextQuestion);
        document.getElementById('prev-btn').addEventListener('click', prevQuestion);
        document.getElementById('print-btn').addEventListener('click', printResults);
        document.getElementById('share-btn').addEventListener('click', shareResults);
        document.getElementById('restart-btn').addEventListener('click', restartExam);
        document.getElementById('back-btn').addEventListener('click', backToExams);

        if (wasResumed) {
            alert(`تم استئناف الامتحان من السؤال ${getQuestionNumber(currentQuestionIndex)}`);
        }
    }

    // بدء الامتحان عند تحميل الصفحة
    window.onload = initExam;
</script>
</body>
</html>